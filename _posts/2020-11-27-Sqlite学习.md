---
title: SQLite学习
categories: SQLite  
tags: SQLite  

---

SQLite:软件库，实现SQL数据库引擎。

1. 特点
    1) 不区分大小写，部分命令大小写敏感（eg. GLOB ）；

2. 语法
    1) 注释：--
    2）数据库
        a) sqlite3 dbname.db 当前目录创建或打开dbname数据库：
        b) sqlite> .databases 查看数据库路径：
        c) sqlite> .quit 退出sqlite提示符
        d) sqlite> .tables 查看数据库表名
        e) sqlite> attach database 'test.db' as test; 将数据库test.db以test命名附加到当前数据库,进程退出后恢复；
        f) sqlite> detach database 'test'; 断开命名为test数据库链接
    3) 表
        a) sqlite> create table tablename (id integer primary key autoincrement, createtime integer);创建表
        b) sqlite> drop table tablename; 删除表
        c) sqlite> insert into tablename [(name, age)] values ('b', 20);向tablename表中添加值
        d) sqlite> update tbalename set columm = value where condation;更新数据 eg. update tb_nn set name = 'nn1' where _id = 1; 
        e) sqlite> delete from tablename;删除表中数据 eg. delete from tb_nn;
            DELETE FROM sqlite_sequence WHERE name = 'table_name';将递增数归零
            UPDATE sqlite_sequence SET seq = 0 WHERE name = 'table_name';
        f) alert table;用于改表名和为表添加列；eg. alter table tb_token rename to tb_tk;  alter table tb_nn add hoby text;
        g) sqlite> .header on 打开输出头部
           sqlite> .mode column  打开列模式,图表显示, (line 行模式eg. name = nn3)
           sqlite> select column1, column2 from tablename; 表tablename，查询列column1，column1的数据
        h) sqlite> .schema [tablename] 查看表sql.
    4）运算符
        a) 算数运算符：+ - * / %（取余）
        b) 比较运算符：(== =) (!= <>) > < >= <= !<(不小于) !>(不大于), eg. select * from tb_nn where age > (select age from tb_nn where name = 'b'); 
        c) 逻辑运算符：and or not 与或非        eg. select not false;
                      between 给定范围内,       eg. select * from tb_nn where age between 10 and 20
                      exists 子查询是否满足     eg. select * from tb_nn where exists (select * from tb_nn where age=30); 
                      in 指定值是否再列表中     eg. select * from tb_nn where age in (10, 11);
                      like(GLOB)与使用通配符的相似值比较 eg. select * from tb_nn where name like '%b';
                      is null 是null           eg. select * from tb_nn where gender is null;
                      is = ; is not !=
                      || 链接2个字符串          eg. select 'a' || 'b'
                      unique 确保列值唯一，用于表创建时使用；
        d) 位运算符：& | ~ 位运算与或非 <<  >>
    5) 表达式
        a) 布尔表达式： eg. select * from tb_nn where age = 10;
        b) 数值表达式： eg. select count(*) as number  from tb_nn;     >number = 7
        c) 日期表达式： eg. select current_timestamp;    > current_timestamp = 2020-11-26 03:51:30
    6）通配符
        a) like
            %代表>=0个数字或字符
            _代表1的数字或字符
        b) GLOB
            *代表>=0个数字或字符
            ?代表1个的数字或字符
    7) 子句
        a) where子句： where后跟判断条件；
        b) limit子句：限定数量，与offset配合从offset + 1条数据取值；eg. select * from tb_nn where _id < 10 limit 2 offset 2; 
        c) order by子句：排序， eg. select * from tb_nn where age=10 order by _id desc limit 2 offset 2; 
        d) group by子句：分组，order by之前 eg. select name, sum(age) from tb_nn where gender='F' group by name;
        e) having子句；在group by子句设置条件； eg. select name, sum(age) from tb_nn where gender='F' group by name having count(name) > 1; 
    8) 关键字
        a) distinct 去除重复 eg. select distinct name from tb_nn; 
        b) pragma 访问或设置环境变量 
            pragma database_list 所有数据库连接信息；（seq, name, file)      0  main  G:\桌面\IT\同步\Python\nn.db 
            pragma encoding      字符串编码方式；set；
            pragma journal_mode  日志存储和处理模式；set;
            pragma max_page_count数据库最大页数：set;
            pragma page_count    数据库页面数量
            pragma page_size     数据库页面大小, set；
            pragma schema_version数据库架构变化值，（create，drop）；
        c) join 多个数据库操作
            cross join 交叉连接， 1表中每一行与2表中每一行匹配，获取查询结果，共x*y行；eg. select id, ip, name from tb_nn cross join tb_dns;
            inner join 内连接，对满足的谓词进行匹配 select id, ip, name from tb_nn inner join tb_dns on tb_nn._id = tb_dns.id;
            outer join 外连接，left 主表和要连接的表,进行数据合并整合，没有的值设为null，eg. select * from tb_nn left outer join tb_dns on tb_nn._id = tb_dns.id;
        d) union  合并多个结果，不返回重复值；union all 合并多个结果，包含重复；
        e) as 别名， eg.select _id as id, name from tb_nn as nn;
    9) 约束
        a) 列级约束
            not null 不为空
            default 默认值
            unique 值唯一
            primary key 数据库记录的唯一标识
            check 满足某一条件
        b) 表级约束
    10）触发器： 触发器是数据库回调函数
        a) 触发条件，数据库update， insert，delete操作before或after；
        b) 只支持for each row触发器；
        d) 生命周期；以关联的表(tbl_name)删除结束；
        e) 作用域：同一数据库；
        f) raise()用于抛出异常；
        g) 使用new.columnname 和old.columnname访问修改的列值；
        h) 创建触发器
            CREATE  TRIGGER trigger_name [BEFORE|AFTER] [UPDATE|insert|delete] OF column_name 
            ON table_name
            WHEN statement
            BEGIN
            -- 触发器逻辑....
            END;
        i) 删除触发器
            DROP TRIGGER trigger_name;
    11) 索引：索引是指向数据库中数据的指针，用于加快搜索；索引有助于加快 SELECT 查询和 WHERE 子句，但它会减慢使用 UPDATE 和 INSERT 语句时的数据输入。
        a) 单列索引; eg. create index name_index on tb_nn (name);
        b) 唯一索引；eg. create unique index phone_index on tb_nn (phone);
        c) 组合索引：eg. create index complex_index on tb_nn (age, height);
        d) sqlite> .index tb_nn 列出表tb_nn的所有索引
        e）删除 DROP INDEX index_name;
        f） indexed by 使用索引，eg. select * from tb_nn indexed by name_index where name like 'n%'; 
    12) 视图,执行特定sql语句，生成的只读虚表；用于汇总数据，
        a) 创建；eg. create view view_nn as select name, age, gender from tb_nn;
        b）查询：eg. select * from view_nn;
        c) 删除：eg. drop view view_nn;
                    
3.db:数据库
    1) sqlite_master:
        a. 随数据库创建的系统表,存放了*.db中所有表的相关信息;
        b. 字段(type text, name text, tbl_name text, rootpage integer, sql text)分别表示（类型，索引，索引所属表名，根页索引值，创建索引的sql语句）
        c. 只读

4. 其他
    SQLite: https://www.sqlite.org
    菜鸟：https://www.runoob.com/sqlite/sqlite-tutorial.html
